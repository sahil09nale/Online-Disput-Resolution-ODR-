<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case Details - ResolveNOW</title>
    <link rel="stylesheet" href="../styles.css">
    <script src="../js/auth.js" defer></script>
    <script src="../js/case-details.js" defer></script>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <a href="dashboard.html"><h2>ResolveNOW</h2></a>
            </div>
            <div class="nav-menu">
                <a href="dashboard.html">Dashboard</a>
                <a href="#" onclick="logout()">Logout</a>
            </div>
        </div>
    </nav>

    <div class="container" style="margin-top: 100px; max-width: 1000px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
            <h1 id="caseTitle">Case Details</h1>
            <div>
                <span id="caseStatus" class="status-badge"></span>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem;">
            <!-- Main Content -->
            <div>
                <!-- Case Information -->
                <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 2rem;">
                    <h3 style="margin-bottom: 1.5rem; color: #1e293b;">Case Information</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div>
                            <strong>Case ID:</strong>
                            <div id="caseId" style="color: #6b7280;"></div>
                        </div>
                        <div>
                            <strong>Type:</strong>
                            <div id="caseType" style="color: #6b7280;"></div>
                        </div>
                        <div>
                            <strong>Amount:</strong>
                            <div id="caseAmount" style="color: #6b7280;"></div>
                        </div>
                        <div>
                            <strong>Submitted:</strong>
                            <div id="caseDate" style="color: #6b7280;"></div>
                        </div>
                    </div>
                </div>

                <!-- Description -->
                <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 2rem;">
                    <h3 style="margin-bottom: 1rem; color: #1e293b;">Description</h3>
                    <p id="caseDescription" style="line-height: 1.6; color: #374151;"></p>
                </div>

                <!-- Desired Outcome -->
                <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 2rem;">
                    <h3 style="margin-bottom: 1rem; color: #1e293b;">Desired Outcome</h3>
                    <p id="caseOutcome" style="line-height: 1.6; color: #374151;"></p>
                </div>

                <!-- Evidence -->
                <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 2rem;">
                    <h3 style="margin-bottom: 1rem; color: #1e293b;">Evidence</h3>
                    <div id="evidenceList">
                        <p style="color: #6b7280;">No evidence files uploaded</p>
                    </div>
                </div>

                <!-- Timeline -->
                <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                    <h3 style="margin-bottom: 1.5rem; color: #1e293b;">Case Timeline</h3>
                    <div id="timeline" style="border-left: 3px solid #e5e7eb; padding-left: 1rem;">
                        <!-- Timeline items will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div>
                <!-- AI Analysis -->
                <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 2rem;">
                    <h3 style="margin-bottom: 1rem; color: #1e293b;">ðŸ¤– AI Analysis</h3>
                    <div style="background: #f8fafc; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                        <h4 style="font-size: 0.875rem; color: #374151; margin-bottom: 0.5rem;">Case Category</h4>
                        <p id="aiCategory" style="color: #2563eb; font-weight: 600;"></p>
                    </div>
                    <div style="background: #f8fafc; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                        <h4 style="font-size: 0.875rem; color: #374151; margin-bottom: 0.5rem;">Complexity Score</h4>
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <div id="complexityBar" style="background: #e5e7eb; height: 8px; border-radius: 4px; flex: 1;">
                                <div style="background: #10b981; height: 100%; width: 60%; border-radius: 4px;"></div>
                            </div>
                            <span style="font-size: 0.875rem; color: #6b7280;">Medium</span>
                        </div>
                    </div>
                    <div style="background: #f8fafc; padding: 1rem; border-radius: 8px;">
                        <h4 style="font-size: 0.875rem; color: #374151; margin-bottom: 0.5rem;">Estimated Resolution</h4>
                        <p style="color: #059669; font-weight: 600;">7-14 days</p>
                    </div>
                </div>

                <!-- Settlement Suggestions -->
                <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 2rem;">
                    <h3 style="margin-bottom: 1rem; color: #1e293b;">ðŸ’¡ AI Settlement Suggestions</h3>
                    <div id="settlementSuggestions">
                        <div style="background: #fef3c7; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border-left: 4px solid #f59e0b;">
                            <h4 style="font-size: 0.875rem; color: #92400e; margin-bottom: 0.5rem;">Recommended</h4>
                            <p style="font-size: 0.875rem; color: #78350f;">Partial refund with service improvement commitment</p>
                        </div>
                        <div style="background: #dbeafe; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border-left: 4px solid #3b82f6;">
                            <h4 style="font-size: 0.875rem; color: #1e40af; margin-bottom: 0.5rem;">Alternative</h4>
                            <p style="font-size: 0.875rem; color: #1e3a8a;">Store credit with extended warranty</p>
                        </div>
                    </div>
                </div>

                <!-- Actions -->
                <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                    <h3 style="margin-bottom: 1rem; color: #1e293b;">Actions</h3>
                    <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                        <button class="btn-primary" onclick="inviteOtherParty()" style="width: 100%;">Invite Other Party</button>
                        <button class="btn-secondary" onclick="requestMediator()" style="width: 100%;">Request Mediator</button>
                        <button class="btn-secondary" onclick="uploadAdditionalEvidence()" style="width: 100%;">Add Evidence</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Check if user is logged in
        if (!localStorage.getItem('isLoggedIn')) {
            window.location.href = 'login.html';
        }

        // Get case ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        const caseId = urlParams.get('id');

        function loadCaseDetails() {
            const cases = JSON.parse(localStorage.getItem('userCases') || '[]');
            const caseData = cases.find(c => c.id === caseId);

            if (!caseData) {
                alert('Case not found');
                window.location.href = 'dashboard.html';
                return;
            }

            // Populate case details
            document.getElementById('caseTitle').textContent = caseData.title || 'Untitled Case';
            document.getElementById('caseId').textContent = caseData.id;
            document.getElementById('caseType').textContent = caseData.disputeType || 'N/A';
            document.getElementById('caseAmount').textContent = caseData.disputeAmount ? `$${caseData.disputeAmount}` : 'N/A';
            document.getElementById('caseDate').textContent = new Date(caseData.submittedAt).toLocaleDateString();
            document.getElementById('caseDescription').textContent = caseData.description || 'No description provided';
            document.getElementById('caseOutcome').textContent = caseData.desiredOutcome || 'No desired outcome specified';
            
            // Set status
            const statusElement = document.getElementById('caseStatus');
            statusElement.textContent = caseData.status;
            statusElement.className = `status-badge status-${caseData.status.toLowerCase()}`;

            // Set AI category
            document.getElementById('aiCategory').textContent = caseData.disputeType || 'Uncategorized';

            // Create timeline
            createTimeline(caseData);
        }

        function createTimeline(caseData) {
            const timeline = document.getElementById('timeline');
            const timelineItems = [
                {
                    date: caseData.submittedAt,
                    title: 'Case Submitted',
                    description: 'Dispute submitted and AI analysis completed',
                    status: 'completed'
                },
                {
                    date: new Date().toISOString(),
                    title: 'Awaiting Response',
                    description: 'Waiting for other party to respond',
                    status: 'current'
                },
                {
                    date: null,
                    title: 'Mediation',
                    description: 'Mediator assigned and mediation begins',
                    status: 'pending'
                },
                {
                    date: null,
                    title: 'Resolution',
                    description: 'Case resolved and agreement finalized',
                    status: 'pending'
                }
            ];

            timeline.innerHTML = timelineItems.map(item => `
                <div style="margin-bottom: 1.5rem; position: relative;">
                    <div style="position: absolute; left: -1.25rem; width: 12px; height: 12px; border-radius: 50%; 
                                background: ${item.status === 'completed' ? '#10b981' : item.status === 'current' ? '#f59e0b' : '#e5e7eb'};
                                border: 3px solid white; box-shadow: 0 0 0 1px #e5e7eb;"></div>
                    <div style="margin-left: 1rem;">
                        <h4 style="font-size: 0.875rem; font-weight: 600; color: #374151;">${item.title}</h4>
                        <p style="font-size: 0.75rem; color: #6b7280; margin-bottom: 0.25rem;">${item.description}</p>
                        ${item.date ? `<p style="font-size: 0.75rem; color: #9ca3af;">${new Date(item.date).toLocaleDateString()}</p>` : ''}
                    </div>
                </div>
            `).join('');
        }

        function inviteOtherParty() {
            const email = prompt('Enter the other party\'s email address:');
            if (email) {
                alert(`Invitation sent to ${email}. They will receive an email with instructions to join the platform and respond to your dispute.`);
            }
        }

        function requestMediator() {
            alert('Mediator request submitted. A qualified mediator will be assigned to your case within 24 hours.');
        }

        function uploadAdditionalEvidence() {
            const input = document.createElement('input');
            input.type = 'file';
            input.multiple = true;
            input.accept = '.pdf,.doc,.docx,.jpg,.jpeg,.png,.mp3,.mp4';
            input.onchange = function() {
                if (this.files.length > 0) {
                    alert(`${this.files.length} file(s) uploaded successfully. Evidence has been added to your case.`);
                }
            };
            input.click();
        }

        function logout() {
            localStorage.removeItem('isLoggedIn');
            window.location.href = 'login.html';
        }

        // Load case details on page load
        loadCaseDetails();
    </script>
</body>
</html>